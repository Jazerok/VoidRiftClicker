[gd_scene format=3 uid="uid://l1tos1yqcrg7"]

[ext_resource type="Script" path="res://Scripts/UI/HUD.gd" id="1_hud"]
[ext_resource type="Script" path="res://Scripts/UI/UpgradePanel.gd" id="2_upgrade_panel"]
[ext_resource type="Script" path="res://Scripts/UI/AbilityHotbar.gd" id="4_hotbar"]
[ext_resource type="Script" path="res://Scripts/UI/DevPanel.gd" id="5_devpanel"]
[ext_resource type="Script" path="res://Scripts/UI/PrestigeScreen.gd" id="6_prestige_screen"]

[sub_resource type="GDScript" id="main_script"]
script/source = "extends Node2D

var portal_center = Vector2(960, 540)  # Centered on screen
var portal_radius = 220.0

func _ready():
	get_window().title = \"Void Rift Clicker\"

func _input(event):
	if event.is_action_pressed(\"toggle_upgrades\"):
		var upgrade_panel = $UI/UpgradePanel
		if upgrade_panel:
			upgrade_panel.visible = !upgrade_panel.visible

	# Toggle Prestige Screen with P or G key
	if event is InputEventKey and event.pressed:
		if event.keycode == KEY_P or event.keycode == KEY_G:
			var prestige_screen = $UI/PrestigeScreen
			if prestige_screen:
				prestige_screen.toggle()

	# Direct click detection as fallback
	if event is InputEventMouseButton:
		if event.button_index == MOUSE_BUTTON_LEFT and event.pressed:
			var mouse_pos = get_global_mouse_position()
			var distance = mouse_pos.distance_to(portal_center)
			if distance <= portal_radius:
				# Trigger portal visual effects
				var portal_visual = get_node_or_null(\"Portal/PortalVisual\")
				if portal_visual:
					portal_visual.click_scale = 0.96
					portal_visual.click_rotation_boost += 0.25
					# Only spawn a ring once per second
					if portal_visual.ring_cooldown <= 0:
						portal_visual.spawn_cosmic_ring()
						portal_visual.ring_cooldown = 1.0
				var gm = get_node_or_null(\"/root/GameManager\")
				if gm:
					gm.process_click()
"

[sub_resource type="GDScript" id="bg_script"]
script/source = "extends Node2D

var stars = []
var distant_stars = []

func _ready():
	var max_x = 2560.0
	var max_y = 1440.0
	for i in range(80):
		distant_stars.append({
			\"pos\": Vector2(randf() * max_x, randf() * max_y),
			\"size\": randf_range(0.3, 1.0),
			\"brightness\": randf_range(0.2, 0.4)
		})
	for i in range(30):
		stars.append({
			\"pos\": Vector2(randf() * max_x, randf() * max_y),
			\"size\": randf_range(1.0, 2.5),
			\"brightness\": randf_range(0.5, 1.0),
			\"color\": randf()
		})
	queue_redraw()

func _draw():
	var vp_size = get_viewport_rect().size
	draw_rect(Rect2(-100, -100, vp_size.x + 200, vp_size.y + 200), Color(0.01, 0.02, 0.05))

	for i in range(4):
		var nx = 200 + i * 400
		var ny = 150 + i * 200
		draw_circle(Vector2(nx, ny), 220 + i * 25, Color(0.03, 0.06, 0.12, 0.06))

	for star in distant_stars:
		draw_circle(star.pos, star.size, Color(0.7, 0.8, 1.0, star.brightness))

	for star in stars:
		var c = get_star_color(star.color, star.brightness)
		draw_circle(star.pos, star.size, c)
		if star.brightness > 0.7:
			draw_circle(star.pos, star.size * 2, Color(c.r, c.g, c.b, star.brightness * 0.2))

	draw_planet(Vector2(1780, 920), 50)
	draw_circle(Vector2(1850, 1020), 4, Color(0.4, 0.6, 0.8, 0.6))
	draw_circle(Vector2(1820, 1000), 3, Color(0.4, 0.6, 0.8, 0.4))

func get_star_color(val, alpha):
	if val < 0.5:
		return Color(1, 1, 1, alpha)
	elif val < 0.75:
		return Color(0.85, 0.92, 1.0, alpha)
	elif val < 0.9:
		return Color(1.0, 0.98, 0.9, alpha)
	else:
		return Color(1.0, 0.9, 0.8, alpha)

func draw_planet(pos, radius):
	draw_circle(pos, radius + 2, Color(0.02, 0.03, 0.06, 0.8))
	draw_circle(pos, radius, Color(0.12, 0.15, 0.22, 0.95))
	draw_circle(pos + Vector2(-radius*0.3, -radius*0.2), radius*0.4, Color(0.08, 0.1, 0.15, 0.5))
	draw_arc(pos, radius - 1, -0.8, 1.2, 24, Color(0.3, 0.45, 0.6, 0.4), 2.0)
	draw_circle(pos, radius + 7, Color(0.15, 0.25, 0.4, 0.025))
"

[sub_resource type="GDScript" id="portal_gd_script"]
script/source = "extends Node2D

var rotation_speed = 0.8
var galaxy_rotation = 0.0
var pulse = 0.0
var is_hovered = false
var click_scale = 1.0
var click_rotation_boost = 0.0

var cosmic_rings = []
var ring_cooldown = 0.0

var bulge_stars = []
var disk_stars = []
var arm_stars = []
var bright_stars = []
var nebulae = []

# Pre-rendered galaxy texture
var galaxy_texture: ImageTexture
var galaxy_sprite: Sprite2D

signal portal_clicked

func _ready():
	create_galaxy()
	_pre_render_galaxy()

func create_galaxy():
	var rng = RandomNumberGenerator.new()
	rng.seed = 12345

	for i in range(60):
		var angle = rng.randf() * TAU
		var dist = rng.randf() * rng.randf() * rng.randf() * 70
		bulge_stars.append({
			\"angle\": angle,
			\"dist\": dist,
			\"size\": rng.randf_range(0.4, 2.5) * (1.0 - dist/90.0),
			\"brightness\": rng.randf_range(0.6, 1.0),
			\"temp\": rng.randf_range(0.0, 0.35)
		})

	for i in range(150):
		var angle = rng.randf() * TAU
		var dist = 30 + rng.randf() * rng.randf() * 200
		disk_stars.append({
			\"angle\": angle,
			\"dist\": dist,
			\"size\": rng.randf_range(0.3, 1.2),
			\"brightness\": rng.randf_range(0.15, 0.5) * (1.0 - dist/280.0),
			\"temp\": rng.randf()
		})

	for arm in range(4):
		var arm_offset = arm * TAU / 4
		for i in range(50):
			var t = rng.randf()
			var spiral_angle = arm_offset + t * 2.8 + rng.randf_range(-0.15, 0.15)
			var base_r = 30 + t * 200
			var r = base_r + rng.randf_range(-15, 15) * (0.3 + t * 0.7)
			if r > 0 and r < 235:
				arm_stars.append({
					\"angle\": spiral_angle,
					\"dist\": r,
					\"size\": rng.randf_range(0.5, 2.2),
					\"brightness\": rng.randf_range(0.5, 1.0) * (0.7 + 0.3 * (1.0 - t)),
					\"temp\": rng.randf_range(0.4, 1.0),
					\"arm\": arm
				})
		var minor_offset = arm_offset + TAU / 8
		for i in range(15):
			var t = rng.randf()
			var spiral_angle = minor_offset + t * 2.5 + rng.randf_range(-0.2, 0.2)
			var r = 50 + t * 160 + rng.randf_range(-20, 20)
			if r > 0 and r < 220:
				arm_stars.append({
					\"angle\": spiral_angle,
					\"dist\": r,
					\"size\": rng.randf_range(0.3, 1.5),
					\"brightness\": rng.randf_range(0.3, 0.7),
					\"temp\": rng.randf_range(0.5, 0.9),
					\"arm\": arm
				})

	for i in range(15):
		var arm = rng.randi() % 4
		var arm_offset = arm * TAU / 4
		var t = rng.randf_range(0.15, 0.85)
		var spiral_angle = arm_offset + t * 2.8 + rng.randf_range(-0.08, 0.08)
		var r = 35 + t * 185 + rng.randf_range(-10, 10)
		bright_stars.append({
			\"angle\": spiral_angle,
			\"dist\": r,
			\"size\": rng.randf_range(1.8, 3.5),
			\"brightness\": rng.randf_range(0.85, 1.0),
			\"temp\": rng.randf_range(0.85, 1.0)
		})

	for i in range(6):
		var arm = rng.randi() % 4
		var arm_offset = arm * TAU / 4
		var t = rng.randf_range(0.2, 0.8)
		var spiral_angle = arm_offset + t * 2.8 + rng.randf_range(-0.1, 0.1)
		var r = 40 + t * 170
		nebulae.append({
			\"angle\": spiral_angle,
			\"dist\": r,
			\"size\": rng.randf_range(15, 35),
			\"color_type\": rng.randi() % 3
		})

func _pre_render_galaxy():
	var tex_size = 600
	var half = tex_size / 2.0
	var img = Image.create(tex_size, tex_size, true, Image.FORMAT_RGBA8)

	# Disk glow
	for i in range(12):
		var r = 240 - i * 18
		var t = i / 12.0
		var col = Color(0.12 + t * 0.5, 0.1 + t * 0.42, 0.22 - t * 0.12, 0.008 + t * 0.02)
		_blit_circle(img, half, half, r, col)

	# Nebulae
	for neb in nebulae:
		var px = half + cos(neb.angle) * neb.dist
		var py = half + sin(neb.angle) * neb.dist
		var c: Color
		match neb.color_type:
			0: c = Color(0.9, 0.4, 0.5, 0.07)
			1: c = Color(0.4, 0.6, 0.9, 0.06)
			_: c = Color(0.6, 0.4, 0.8, 0.05)
		_blit_circle(img, px, py, neb.size, c)
		_blit_circle(img, px, py, neb.size * 0.6, Color(c.r, c.g, c.b, c.a * 0.6))

	# Spiral arm glow via dots along path
	for arm in range(4):
		var arm_offset = arm * TAU / 4
		for si in range(30):
			var t = si / 30.0
			var angle = arm_offset + t * 2.8
			var r = 25 + t * 210
			var px = half + cos(angle) * r
			var py = half + sin(angle) * r
			var fade = sin(t * PI) * (1.0 - t * 0.25)
			_blit_circle(img, px, py, 20, Color(0.35, 0.45, 0.7, 0.05 * fade))

	# Disk stars
	for star in disk_stars:
		var px = half + cos(star.angle) * star.dist
		var py = half + sin(star.angle) * star.dist
		var c = get_star_color(star.temp, star.brightness)
		_blit_circle(img, px, py, max(star.size, 0.8), c)

	# Arm stars
	for star in arm_stars:
		var px = half + cos(star.angle) * star.dist
		var py = half + sin(star.angle) * star.dist
		var c = get_star_color(star.temp, star.brightness)
		_blit_circle(img, px, py, max(star.size * 1.15, 0.8), c)

	# Bright stars with glow
	for star in bright_stars:
		var px = half + cos(star.angle) * star.dist
		var py = half + sin(star.angle) * star.dist
		var a = star.brightness
		_blit_circle(img, px, py, star.size * 2.5, Color(0.4, 0.6, 1.0, a * 0.2))
		_blit_circle(img, px, py, star.size, Color(0.9, 0.95, 1.0, a))

	# Bulge stars
	for star in bulge_stars:
		var px = half + cos(star.angle) * star.dist
		var py = half + sin(star.angle) * star.dist
		var c = get_star_color(star.temp, star.brightness)
		_blit_circle(img, px, py, max(star.size, 0.8), c)

	galaxy_texture = ImageTexture.create_from_image(img)
	galaxy_sprite = Sprite2D.new()
	galaxy_sprite.texture = galaxy_texture
	galaxy_sprite.z_index = -1
	add_child(galaxy_sprite)

func _blit_circle(img: Image, cx: float, cy: float, radius: float, color: Color):
	var w = img.get_width()
	var h = img.get_height()
	var r_ceil = int(ceil(radius)) + 1
	var ix = int(round(cx))
	var iy = int(round(cy))
	for dy in range(-r_ceil, r_ceil + 1):
		for dx in range(-r_ceil, r_ceil + 1):
			var px = ix + dx
			var py = iy + dy
			if px < 0 or px >= w or py < 0 or py >= h:
				continue
			var dist = sqrt(float(dx * dx + dy * dy))
			if dist > radius + 0.5:
				continue
			var edge = clampf(radius + 0.5 - dist, 0.0, 1.0)
			var a = color.a * edge
			if a < 0.002:
				continue
			var existing = img.get_pixel(px, py)
			var out_a = a + existing.a * (1.0 - a)
			if out_a > 0.001:
				var inv = existing.a * (1.0 - a)
				img.set_pixel(px, py, Color(
					(color.r * a + existing.r * inv) / out_a,
					(color.g * a + existing.g * inv) / out_a,
					(color.b * a + existing.b * inv) / out_a,
					out_a
				))

func _process(delta):
	galaxy_rotation += delta * (rotation_speed + click_rotation_boost)
	pulse += delta * 1.5
	click_scale = lerp(click_scale, 1.0 if not is_hovered else 1.03, delta * 6)
	click_rotation_boost *= 0.97

	if ring_cooldown > 0:
		ring_cooldown -= delta

	# Update cosmic rings
	var i = cosmic_rings.size() - 1
	while i >= 0:
		cosmic_rings[i].life -= delta
		if cosmic_rings[i].life <= 0:
			cosmic_rings.remove_at(i)
		i -= 1

	# Rotate the pre-rendered galaxy sprite
	if galaxy_sprite:
		galaxy_sprite.rotation = galaxy_rotation * 0.0174533
		galaxy_sprite.scale = Vector2(click_scale, click_scale)

	queue_redraw()

func _draw():
	var center = Vector2.ZERO
	var draw_scale = click_scale

	# Outer halo - reduced layers
	for i in range(8):
		var alpha = 0.025 - i * 0.003
		var r = (250 + i * 40) * draw_scale
		draw_circle(center, r, Color(0.08, 0.12, 0.22, alpha))

	# Galactic core pulse
	var core_pulse = 1.0 + sin(pulse) * 0.06

	for i in range(8):
		var r = (65 - i * 7) * core_pulse * draw_scale
		var t = i / 8.0
		draw_circle(center, r, Color(0.95, 0.7, 0.35, 0.025 + t * 0.05))

	for i in range(5):
		var r = (38 - i * 6) * core_pulse * draw_scale
		draw_circle(center, r, Color(1.0, 0.9, 0.65, 0.08 + i * 0.08))

	for i in range(4):
		var r = (18 - i * 4) * core_pulse * draw_scale
		draw_circle(center, r, Color(1.0, 0.96, 0.85, 0.25 + i * 0.15))

	draw_circle(center, 6 * draw_scale, Color(1.0, 0.98, 0.92, 0.95))
	draw_circle(center, 3 * draw_scale, Color(1, 1, 0.98, 1))

	# Cosmic ring waves
	for ring in cosmic_rings:
		var progress = 1.0 - (ring.life / ring.max_life)
		var ring_size = lerp(ring.start_size, ring.end_size, ease(progress, 0.5))
		var alpha = sin(progress * PI) * 0.7
		var ring_color: Color
		match ring.color_type:
			0: ring_color = Color(0.7, 0.4, 1.0, alpha)
			1: ring_color = Color(0.4, 0.8, 1.0, alpha)
			2: ring_color = Color(1.0, 0.8, 0.4, alpha)
		var ring_width = lerp(4.0, 0.5, progress)
		draw_arc(center, ring_size * draw_scale, 0, TAU, 32, ring_color, ring_width)

func get_star_color(temp, alpha):
	if temp < 0.15:
		return Color(1.0, 0.75, 0.5, alpha)
	elif temp < 0.3:
		return Color(1.0, 0.88, 0.65, alpha)
	elif temp < 0.5:
		return Color(1.0, 0.98, 0.85, alpha)
	elif temp < 0.7:
		return Color(1.0, 1.0, 1.0, alpha)
	elif temp < 0.85:
		return Color(0.85, 0.92, 1.0, alpha)
	else:
		return Color(0.65, 0.8, 1.0, alpha)

func _on_click_area_input_event(_viewport, event, _shape_idx):
	if event is InputEventMouseButton:
		if event.button_index == MOUSE_BUTTON_LEFT and event.pressed:
			click_scale = 0.96
			click_rotation_boost += 0.25
			if ring_cooldown <= 0:
				spawn_cosmic_ring()
				ring_cooldown = 1.0
			emit_signal(\"portal_clicked\")
			var gm = get_node_or_null(\"/root/GameManager\")
			if gm:
				gm.process_click()

func spawn_cosmic_ring():
	var ring = {
		\"life\": 1.8,
		\"max_life\": 1.8,
		\"start_size\": 20.0,
		\"end_size\": 300.0,
		\"color_type\": randi() % 3
	}
	cosmic_rings.append(ring)

func _on_click_area_mouse_entered():
	is_hovered = true
	Input.set_default_cursor_shape(Input.CURSOR_POINTING_HAND)

func _on_click_area_mouse_exited():
	is_hovered = false
	Input.set_default_cursor_shape(Input.CURSOR_ARROW)
"

[sub_resource type="CircleShape2D" id="CircleShape2D_portal"]
radius = 220.0

[sub_resource type="GDScript" id="click_connector_script"]
script/source = "extends Node2D

# This script connects the GDScript portal to the C# GameManager

func _ready():
	var portal = get_node_or_null(\"../PortalVisual\")
	if portal:
		portal.connect(\"portal_clicked\", _on_portal_clicked)

func _on_portal_clicked():
	var game_manager = get_node_or_null(\"/root/GameManager\")
	if game_manager:
		game_manager.call(\"ProcessClick\")
"

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_topbar"]
bg_color = Color(0.08, 0.04, 0.12, 0.95)
border_width_bottom = 2
border_color = Color(0.5, 0.3, 0.8, 0.5)

[node name="Main" type="Node2D" unique_id=1832979285]
script = SubResource("main_script")

[node name="Background" type="CanvasLayer" parent="." unique_id=1900017383]
layer = -10

[node name="SpaceDrawing" type="Node2D" parent="Background" unique_id=131219029]
script = SubResource("bg_script")

[node name="Portal" type="Node2D" parent="." unique_id=1320837996]
position = Vector2(960, 540)

[node name="PortalVisual" type="Node2D" parent="Portal" unique_id=1132234076]
script = SubResource("portal_gd_script")

[node name="ClickArea" type="Area2D" parent="Portal/PortalVisual" unique_id=533737836]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Portal/PortalVisual/ClickArea" unique_id=214339372]
shape = SubResource("CircleShape2D_portal")

[node name="ClickConnector" type="Node2D" parent="Portal" unique_id=1360828077]
script = SubResource("click_connector_script")

[node name="UI" type="CanvasLayer" parent="." unique_id=1251542181]
layer = 10

[node name="HUD" type="Control" parent="UI" unique_id=333456303]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("1_hud")

[node name="TopBar" type="PanelContainer" parent="UI/HUD" unique_id=246757188]
layout_mode = 1
anchors_preset = 10
anchor_right = 1.0
offset_bottom = 90.0
grow_horizontal = 2
theme_override_styles/panel = SubResource("StyleBoxFlat_topbar")

[node name="MarginContainer" type="MarginContainer" parent="UI/HUD/TopBar" unique_id=877640038]
layout_mode = 2
theme_override_constants/margin_left = 20
theme_override_constants/margin_top = 10
theme_override_constants/margin_right = 20
theme_override_constants/margin_bottom = 10

[node name="HBox" type="HBoxContainer" parent="UI/HUD/TopBar/MarginContainer" unique_id=817969680]
layout_mode = 2
theme_override_constants/separation = 60

[node name="EnergyContainer" type="VBoxContainer" parent="UI/HUD/TopBar/MarginContainer/HBox" unique_id=65240665]
layout_mode = 2

[node name="EnergyTitle" type="Label" parent="UI/HUD/TopBar/MarginContainer/HBox/EnergyContainer" unique_id=1961402990]
layout_mode = 2
theme_override_colors/font_color = Color(0.7, 0.5, 1, 1)
theme_override_font_sizes/font_size = 14
text = "VOID ENERGY"

[node name="VoidEnergyLabel" type="Label" parent="UI/HUD/TopBar/MarginContainer/HBox/EnergyContainer" unique_id=1620832473]
layout_mode = 2
theme_override_colors/font_color = Color(1, 0.9, 0.5, 1)
theme_override_font_sizes/font_size = 36
text = "0"

[node name="IncomeContainer" type="VBoxContainer" parent="UI/HUD/TopBar/MarginContainer/HBox" unique_id=1038977391]
layout_mode = 2

[node name="IncomeTitle" type="Label" parent="UI/HUD/TopBar/MarginContainer/HBox/IncomeContainer" unique_id=1444771331]
layout_mode = 2
theme_override_colors/font_color = Color(0.7, 0.5, 1, 1)
theme_override_font_sizes/font_size = 14
text = "PER SECOND"

[node name="PassiveIncomeLabel" type="Label" parent="UI/HUD/TopBar/MarginContainer/HBox/IncomeContainer" unique_id=443822166]
layout_mode = 2
theme_override_colors/font_color = Color(0.5, 1, 0.7, 1)
theme_override_font_sizes/font_size = 28
text = "+0/sec"

[node name="ClickContainer" type="VBoxContainer" parent="UI/HUD/TopBar/MarginContainer/HBox" unique_id=155597152]
layout_mode = 2

[node name="ClickTitle" type="Label" parent="UI/HUD/TopBar/MarginContainer/HBox/ClickContainer" unique_id=1094448065]
layout_mode = 2
theme_override_colors/font_color = Color(0.7, 0.5, 1, 1)
theme_override_font_sizes/font_size = 14
text = "CLICK POWER"

[node name="ClickPowerLabel" type="Label" parent="UI/HUD/TopBar/MarginContainer/HBox/ClickContainer" unique_id=883272423]
layout_mode = 2
theme_override_colors/font_color = Color(1, 0.7, 0.5, 1)
theme_override_font_sizes/font_size = 28
text = "+1/click"

[node name="FrenzyIndicator" type="PanelContainer" parent="UI/HUD" unique_id=1767689198]
visible = false
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -100.0
offset_top = 100.0
offset_right = 100.0
offset_bottom = 140.0
grow_horizontal = 2

[node name="FrenzyLabel" type="Label" parent="UI/HUD/FrenzyIndicator" unique_id=691755158]
layout_mode = 2
theme_override_colors/font_color = Color(1, 0.8, 0.2, 1)
theme_override_font_sizes/font_size = 24
text = "✦ COSMIC SURGE x2 ✦"
horizontal_alignment = 1

[node name="UpgradePanel" type="Control" parent="UI" unique_id=1409224465]
visible = false
mouse_filter = 2
script = ExtResource("2_upgrade_panel")

[node name="AbilityHotbar" type="Control" parent="UI" unique_id=1721380572]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("4_hotbar")

[node name="DevPanel" type="Control" parent="UI" unique_id=929743881]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
script = ExtResource("5_devpanel")

[node name="PrestigeScreen" type="Control" parent="UI"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 1
script = ExtResource("6_prestige_screen")

[node name="Instructions" type="Label" parent="UI" unique_id=1450276151]
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -200.0
offset_top = -25.0
offset_right = 200.0
grow_horizontal = 2
grow_vertical = 0
theme_override_colors/font_color = Color(0.5, 0.55, 0.65, 0.8)
theme_override_font_sizes/font_size = 11
text = "Click the galaxy to harvest energy! Press 1-5 for abilities. Press P for Prestige."
horizontal_alignment = 1

[connection signal="input_event" from="Portal/PortalVisual/ClickArea" to="Portal/PortalVisual" method="_on_click_area_input_event"]
[connection signal="mouse_entered" from="Portal/PortalVisual/ClickArea" to="Portal/PortalVisual" method="_on_click_area_mouse_entered"]
[connection signal="mouse_exited" from="Portal/PortalVisual/ClickArea" to="Portal/PortalVisual" method="_on_click_area_mouse_exited"]
